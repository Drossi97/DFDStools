---
interface Props {
  id: string;
  name: string;
  value?: string;
  placeholder?: string;
  required?: boolean;
  class?: string;
}

const { id, name, value = '', placeholder = 'HH:MM', required = false, class: className = '' } = Astro.props;
---

<input 
  id={id}
  name={name}
  type="text" 
  value={value}
  placeholder={placeholder}
  required={required}
  maxlength="5"
  class={`time-input ${className}`}
  pattern="^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"
/>

<style>
  .time-input {
    width: 100%;
    padding: 6px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
    color: #111827;
    background: #f9fafb;
    outline: none;
    transition: border-color 0.2s;
    text-align: center;
    font-family: system-ui, -apple-system, sans-serif;
  }

  .time-input:focus {
    border-color: #002B45;
    outline: none;
  }

  .time-input::placeholder {
    color: #9ca3af;
  }

  .time-input:invalid {
    border-color: #ef4444;
  }

  .time-input:disabled {
    background: #f3f4f6;
    color: #6b7280;
    cursor: not-allowed;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const timeInputs = document.querySelectorAll('.time-input');
    
    timeInputs.forEach(input => {
      const timeInput = input as HTMLInputElement;
      
      timeInput.addEventListener('input', function(e) {
        let value = (e.target as HTMLInputElement).value;
        
        // Permitir solo dígitos y dos puntos
        value = value.replace(/[^\d:]/g, '');
        
        // Limitar a 5 caracteres
        if (value.length > 5) {
          value = value.slice(0, 5);
        }
        
        // Asegurar que solo haya un ":"
        const parts = value.split(':');
        if (parts.length > 2) {
          value = parts[0] + ':' + parts.slice(1).join('');
        }
        
        // Formateo automático
        if (value.length === 2 && !value.includes(':')) {
          value = value + ':';
        }
        
        timeInput.value = value;
      });
      
      timeInput.addEventListener('blur', function(e) {
        let value = (e.target as HTMLInputElement).value;
        
        if (value && value.length === 5) {
          const [hours, minutes] = value.split(':');
          const h = parseInt(hours, 10);
          const m = parseInt(minutes, 10);
          
          // Validar y formatear
          if (h >= 0 && h <= 23 && m >= 0 && m <= 59) {
            timeInput.value = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
          } else {
            // Si no es válido, limpiar
            timeInput.value = '';
          }
        } else if (value && value.length === 4 && !value.includes(':')) {
          // Si tiene 4 dígitos sin :, añadirlo
          const paddedValue = value.padStart(4, '0');
          const formatted = `${paddedValue.slice(0, 2)}:${paddedValue.slice(2)}`;
          const [h, m] = formatted.split(':').map(Number);
          
          if (h >= 0 && h <= 23 && m >= 0 && m <= 59) {
            timeInput.value = formatted;
          } else {
            timeInput.value = '';
          }
        }
      });
    });
  });
</script>
